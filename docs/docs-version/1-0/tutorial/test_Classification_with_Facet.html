
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Classification with FACET: Prediabetes Study &#8212; facet  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/gamma.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/js/gamma.js"></script>
    <script src="../_static/js/versions.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/Gamma_Facet_Logo_RGB_LB.svg" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting_started/getting_started.html">Getting started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../apidoc/facet.html">API reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../tutorials.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contribution_guide.html">Development Guidelines</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../faqs.html">FAQ</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../about_us.html">About us</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../release_notes.html">Release Notes</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Classification with FACET: Prediabetes Study</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Required-imports" class="nav-link">Required imports</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Preprocessing-and-initial-feature-selection" class="nav-link">Preprocessing and initial feature selection</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Selecting-a-learner-using-FACET-ranker" class="nav-link">Selecting a learner using FACET ranker</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Using-FACET-for-advanced-model-inspection" class="nav-link">Using FACET for advanced model inspection</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Feature-importance" class="nav-link">Feature importance</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Synergy" class="nav-link">Synergy</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Redundancy" class="nav-link">Redundancy</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Feature-clustering" class="nav-link">Feature clustering</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Removing-redundant-features" class="nav-link">Removing redundant features</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#FACET-univariate-simulator:-the-impact-of-waist-to-height-ratio" class="nav-link">FACET univariate simulator: the impact of waist to height ratio</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Summary" class="nav-link">Summary</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#What-can-you-do-next?" class="nav-link">What can you do next?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Appendix" class="nav-link">Appendix</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Data-source-and-study-cohort" class="nav-link">Data source and study cohort</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Exploratory-Data-Analysis-(EDA)" class="nav-link">Exploratory Data Analysis (EDA)</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<p><img alt="f64f661979be4c66a8d77790f40418fa" class="no-scaled-link" src="../_images/Gamma_Facet_Logo_RGB_LB.svg" width="500" /></p>
<div class="section" id="Classification-with-FACET:-Prediabetes-Study">
<h1>Classification with FACET: Prediabetes Study<a class="headerlink" href="#Classification-with-FACET:-Prediabetes-Study" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>FACET is composed of the following key components:</p>
<ul>
<li><p><strong>Model Inspection</strong></p>
<p>FACET introduces a new algorithm to quantify dependencies and interactions between features in ML models. This new tool for human-explainable AI adds a new, global perspective to the observation-level explanations provided by the popular <a class="reference external" href="https://shap.readthedocs.io/en/latest/">SHAP</a> approach. To learn more about FACET’s model inspection capabilities, see the getting started example below.</p>
</li>
<li><p><strong>Model Simulation</strong></p>
<p>FACET’s model simulation algorithms use ML models for <em>virtual experiments</em> to help identify scenarios that optimise predicted outcomes. To quantify the uncertainty in simulations, FACET utilises a range of bootstrapping algorithms including stationary and stratified bootstraps. For an example of FACET’s bootstrap simulations, see the getting started example below.</p>
</li>
<li><p><strong>Enhanced Machine Learning Workflow</strong></p>
<p>FACET offers an efficient and transparent machine learning workflow, enhancing <a class="reference external" href="https://scikit-learn.org/stable/index.html">scikit-learn</a>’s tried and tested pipelining paradigm with new capabilities for model selection, inspection, and simulation. FACET also introduces <a class="reference external" href="https://github.com/BCG-Gamma/sklearndf">sklearndf</a>, an augmented version of <em>scikit-learn</em> with enhanced support for <em>pandas</em> dataframes that ensures end-to-end traceability of features.</p>
</li>
</ul>
<hr class="docutils" />
<p><strong>Context</strong></p>
<p>Prediabetes is a treatable condition that leads to many health complications and eventually type 2 diabetes. Identification of individuals at risk of prediabetes can improve early intervention and provide insights into those interventions that work best. Using a cohort of healthy (<em>n</em>=2847) and prediabetic (<em>n</em>=1509) patients derived from the <a class="reference external" href="https://wwwn.cdc.gov/nchs/nhanes/Search/DataPage.aspx?Component=Examination&amp;CycleBeginYear=2013">NHANES 2013-14 U.S. cross-sectional survey</a> we aim
to create a classifier for prediabetes. For further details on data sources, definitions and the study cohort please see the Appendix (<a class="reference external" href="#Data-source-and-study-cohort">Data source and study cohort</a>).</p>
<p>Utilizing FACET, we will do the following:</p>
<ol class="arabic simple">
<li><p>create a pipeline to find identify a well-performing classifier.</p></li>
<li><p>perform model inspection and simulation to gain understanding and insight into key factors predictive of prediabetes.</p></li>
</ol>
<hr class="docutils" />
<p><strong>Tutorial outline</strong></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Required-imports">Required imports</a></p></li>
<li><p><a class="reference external" href="#Preprocessing-and-initial-feature-selection">Preprocessing and initial feature selection</a></p></li>
<li><p><a class="reference external" href="#Selecting-a-learner-using-FACET-ranker">Selecting a learner using FACET ranker</a></p></li>
<li><p><a class="reference external" href="#Using-FACET-for-advanced-model-inspection">Using FACET for advanced model inspection</a></p></li>
<li><p><a class="reference external" href="#FACET-univariate-simulator:-the-impact-of-waist-to-height-ratio">FACET univariate simulator: the impact of waist to height ratio</a></p></li>
<li><p><a class="reference external" href="#Summary">Summary</a></p></li>
<li><p><a class="reference external" href="#What-can-you-do-next?">What can you do next?</a></p></li>
<li><p><a class="reference external" href="#Appendix">Appendix</a></p></li>
</ol>
</div>
<div class="section" id="Required-imports">
<h1>Required imports<a class="headerlink" href="#Required-imports" title="Permalink to this headline">¶</a></h1>
<p>In order to run this notebook, we will import not only the FACET package, but also other packages useful to solve this task. Overall, we can break down the imports into three categories:</p>
<ol class="arabic simple">
<li><p>Common packages (pandas, matplotlib, etc.)</p></li>
<li><p>Required FACET classes (inspection, selection, validation, simulation, etc.)</p></li>
<li><p>Other BCG GAMMA packages which simplify pipelining (sklearndf, see on <a class="reference external" href="https://github.com/orgs/BCG-Gamma/sklearndf/">GitHub</a>) and support visualization (pytools, see on <a class="reference external" href="https://github.com/BCG-Gamma/pytools">GitHub</a>) when using FACET</p></li>
</ol>
<p><strong>Common package imports</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">shap</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tableone</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_selector</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RepeatedKFold</span>
</pre></div>
</div>
</div>
<p><strong>FACET imports</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">facet.data</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span> <span class="nn">facet.inspection</span> <span class="kn">import</span> <span class="n">LearnerInspector</span>
<span class="kn">from</span> <span class="nn">facet.selection</span> <span class="kn">import</span> <span class="n">LearnerRanker</span><span class="p">,</span> <span class="n">LearnerGrid</span>
<span class="kn">from</span> <span class="nn">facet.validation</span> <span class="kn">import</span> <span class="n">BootstrapCV</span>
<span class="kn">from</span> <span class="nn">facet.data.partition</span> <span class="kn">import</span> <span class="n">ContinuousRangePartitioner</span>
<span class="kn">from</span> <span class="nn">facet.simulation</span> <span class="kn">import</span> <span class="n">UnivariateProbabilitySimulator</span>
<span class="kn">from</span> <span class="nn">facet.simulation.viz</span> <span class="kn">import</span> <span class="n">SimulationDrawer</span>
<span class="kn">from</span> <span class="nn">facet.crossfit</span> <span class="kn">import</span> <span class="n">LearnerCrossfit</span>
</pre></div>
</div>
</div>
<p><strong>sklearndf imports</strong></p>
<p>Instead of using the “regular” scikit-learn package, we are going to use sklearndf (see on <a class="reference external" href="https://github.com/orgs/BCG-Gamma/sklearndf/">GitHub</a>). sklearndf is an open source library designed to address a common issue with scikit-learn: the outputs of transformers are numpy arrays, even when the input is a data frame. However, to inspect a model it is essential to keep track of the feature names. sklearndf retains all the functionality available through scikit-learn plus the feature
traceability and usability associated with Pandas data frames. Additionally, the names of all your favourite scikit-learn functions are the same except for <code class="docutils literal notranslate"><span class="pre">DF</span></code> on the end. For example, the standard scikit-learn import:</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sklearn.pipeline</span> <span class="pre">import</span> <span class="pre">Pipeline</span></code></p>
<p>becomes:</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sklearndf.pipeline</span> <span class="pre">import</span> <span class="pre">PipelineDF</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearndf.pipeline</span> <span class="kn">import</span> <span class="n">PipelineDF</span><span class="p">,</span> <span class="n">ClassifierPipelineDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.classification</span> <span class="kn">import</span> <span class="n">RandomForestClassifierDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.classification.extra</span> <span class="kn">import</span> <span class="n">LGBMClassifierDF</span>
<span class="kn">from</span> <span class="nn">sklearndf.transformation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ColumnTransformerDF</span><span class="p">,</span>
    <span class="n">OneHotEncoderDF</span><span class="p">,</span>
    <span class="n">SimpleImputerDF</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearndf.transformation.extra</span> <span class="kn">import</span> <span class="n">BorutaDF</span>
</pre></div>
</div>
</div>
<p><strong>pytools imports</strong></p>
<p>pytools (see on <a class="reference external" href="https://github.com/BCG-Gamma/pytools">GitHub</a>) is an open source library containing general machine learning and visualization utilities, some of which are useful for visualising the advanced model inspection capabilities of FACET.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pytools.viz.dendrogram</span> <span class="kn">import</span> <span class="n">DendrogramDrawer</span>
<span class="kn">from</span> <span class="nn">pytools.viz.matrix</span> <span class="kn">import</span> <span class="n">MatrixDrawer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Preprocessing-and-initial-feature-selection">
<h1>Preprocessing and initial feature selection<a class="headerlink" href="#Preprocessing-and-initial-feature-selection" title="Permalink to this headline">¶</a></h1>
<p>First we need to load our prediabetes data and create a simple preprocessing pipeline. For those interested some initial EDA can be found in the Appendix (<a class="reference external" href="#Exploratory-Data-Analysis-(EDA)">Exploratory Data Analysis</a>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load the prepared data frame</span>
<span class="n">prediab_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;pre_diab_nhanes.csv&quot;</span><span class="p">)</span>

<span class="c1"># create a couple of new interesting features</span>
<span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;SBP_to_DBP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Average_SBP&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Average_DBP&quot;</span><span class="p">]</span>
<span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Waist_to_hgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Waist_Circumference&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Standing_Height&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># make clear based on dtypes these two features are categorical</span>
<span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;General_health&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;General_health&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Healthy_diet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediab_df</span><span class="p">[</span><span class="s2">&quot;Healthy_diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>

<span class="c1"># have a look</span>
<span class="n">prediab_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>Waist_Circumference</th>
      <th>Weight</th>
      <th>Standing_Height</th>
      <th>BMI</th>
      <th>Average_SBP</th>
      <th>Average_DBP</th>
      <th>HDL_Cholesterol</th>
      <th>Total_Cholesterol</th>
      <th>...</th>
      <th>Osmolality</th>
      <th>Sodium</th>
      <th>Potassium</th>
      <th>Gamma_glutamyl_transferase</th>
      <th>Calcium</th>
      <th>Alanine_aminotransferase</th>
      <th>Aspartate_aminotransferase</th>
      <th>Pre_diab</th>
      <th>SBP_to_DBP</th>
      <th>Waist_to_hgt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>73.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>162.4</td>
      <td>19.7</td>
      <td>137.333333</td>
      <td>86.666667</td>
      <td>85.0</td>
      <td>201.0</td>
      <td>...</td>
      <td>290.0</td>
      <td>142.0</td>
      <td>4.1</td>
      <td>31.0</td>
      <td>10.0</td>
      <td>28.0</td>
      <td>36.0</td>
      <td>1</td>
      <td>1.584615</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>56.0</td>
      <td>1.0</td>
      <td>123.1</td>
      <td>105.0</td>
      <td>158.7</td>
      <td>41.7</td>
      <td>157.333333</td>
      <td>82.000000</td>
      <td>38.0</td>
      <td>226.0</td>
      <td>...</td>
      <td>287.0</td>
      <td>143.0</td>
      <td>3.3</td>
      <td>22.0</td>
      <td>9.3</td>
      <td>16.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>1.918699</td>
      <td>0.775677</td>
    </tr>
    <tr>
      <th>2</th>
      <td>61.0</td>
      <td>2.0</td>
      <td>110.8</td>
      <td>93.4</td>
      <td>161.8</td>
      <td>35.7</td>
      <td>122.666667</td>
      <td>80.666667</td>
      <td>58.0</td>
      <td>168.0</td>
      <td>...</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>3.9</td>
      <td>17.0</td>
      <td>9.9</td>
      <td>21.0</td>
      <td>20.0</td>
      <td>1</td>
      <td>1.520661</td>
      <td>0.684796</td>
    </tr>
    <tr>
      <th>3</th>
      <td>56.0</td>
      <td>2.0</td>
      <td>85.5</td>
      <td>61.8</td>
      <td>152.8</td>
      <td>26.5</td>
      <td>122.000000</td>
      <td>72.666667</td>
      <td>59.0</td>
      <td>278.0</td>
      <td>...</td>
      <td>277.0</td>
      <td>139.0</td>
      <td>4.0</td>
      <td>21.0</td>
      <td>9.5</td>
      <td>24.0</td>
      <td>23.0</td>
      <td>0</td>
      <td>1.678899</td>
      <td>0.559555</td>
    </tr>
    <tr>
      <th>4</th>
      <td>65.0</td>
      <td>1.0</td>
      <td>93.7</td>
      <td>65.3</td>
      <td>172.4</td>
      <td>22.0</td>
      <td>141.333333</td>
      <td>77.333333</td>
      <td>79.0</td>
      <td>173.0</td>
      <td>...</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>4.8</td>
      <td>24.0</td>
      <td>9.5</td>
      <td>20.0</td>
      <td>29.0</td>
      <td>0</td>
      <td>1.827586</td>
      <td>0.543503</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># to ensure a quick run we will use a random sample of 1000 observations</span>
<span class="n">prediab_df</span> <span class="o">=</span> <span class="n">prediab_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For easier data management we will create a sample object using FACET’s <code class="docutils literal notranslate"><span class="pre">Sample</span></code> class, which allows us to:</p>
<ul class="simple">
<li><p>Quickly access the target vs. features</p></li>
<li><p>Pass our data into sklearndf pipelines</p></li>
<li><p>Pass information to other FACET functions</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a FACET sample object</span>
<span class="n">prediab</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span>
    <span class="n">observations</span><span class="o">=</span><span class="n">prediab_df</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="n">prediab_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">target_name</span><span class="o">=</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we create a minimum preprocessing pipeline which based on our initial EDA (<a class="reference external" href="#Exploratory-Data-Analysis-(EDA)">Exploratory Data Analysis</a>) needs to address the following:</p>
<ol class="arabic simple">
<li><p>Simple imputation for missing values in both continuous and categorical features</p></li>
<li><p>One-hot encoding for categorical features</p></li>
</ol>
<p>We will use the sklearndf wrappers for scikit-learn functions such as <code class="docutils literal notranslate"><span class="pre">SimpleImputerDF</span></code> in place of <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code>, <code class="docutils literal notranslate"><span class="pre">OneHotEncoderDF</span></code> in place of <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code>, and so on.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># for categorical features we will use the mode as the imputation value and also one-hot encode</span>
<span class="n">preprocessing_categorical</span> <span class="o">=</span> <span class="n">PipelineDF</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputerDF</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;&lt;na&gt;&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;one-hot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoderDF</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># for numeric features we will impute using the median</span>
<span class="n">preprocessing_numerical</span> <span class="o">=</span> <span class="n">SimpleImputerDF</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>

<span class="c1"># put the pipeline together</span>
<span class="n">preprocessing_features</span> <span class="o">=</span> <span class="n">ColumnTransformerDF</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="s2">&quot;categorical&quot;</span><span class="p">,</span>
            <span class="n">preprocessing_categorical</span><span class="p">,</span>
            <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;numerical&quot;</span><span class="p">,</span>
            <span class="n">preprocessing_numerical</span><span class="p">,</span>
            <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, we perform some initial feature selection using Boruta, a recent approach shown to have quite good performance. The Boruta algorithm removes features that are no more predictive than random noise. If you are interested further, please see this <a class="reference external" href="https://www.jstatsoft.org/article/view/v036i11">article</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BorutaDF</span></code> transformer in our sklearndf package provides easy access to this powerful method. The approach relies on a tree-based learner, usually a random forest. For settings, a <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> of between 3 and 7 is typically recommended, and here we rely on the default setting of 5. However, as this depends on the number of features and the complexity of interactions one could also explore the sensitivity of feature selection to this parameter. The number of trees is automatically managed
by the Boruta feature selector argument <code class="docutils literal notranslate"><span class="pre">n_estimators=&quot;auto&quot;</span></code>.</p>
<p>We also use parallelization for the random forest using <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code> to accelerate the Boruta iterations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create the pipeline for Boruta</span>
<span class="n">boruta_feature_selection</span> <span class="o">=</span> <span class="n">PipelineDF</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">preprocessing_features</span><span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;boruta&quot;</span><span class="p">,</span>
            <span class="n">BorutaDF</span><span class="p">(</span>
                <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestClassifierDF</span><span class="p">(</span>
                    <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
                <span class="p">),</span>
                <span class="n">n_estimators</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># run feature selection using Boruta and report those selected</span>
<span class="n">boruta_feature_selection</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">prediab</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">prediab</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">selected</span> <span class="o">=</span> <span class="n">boruta_feature_selection</span><span class="o">.</span><span class="n">feature_names_original_</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">selected</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;Age&#39;, &#39;Waist_Circumference&#39;, &#39;BMI&#39;, &#39;Average_SBP&#39;, &#39;RBC_count&#39;,
       &#39;Hematocrit&#39;, &#39;Uric_acid&#39;, &#39;Gamma_glutamyl_transferase&#39;,
       &#39;SBP_to_DBP&#39;, &#39;Waist_to_hgt&#39;], dtype=object)
</pre></div></div>
</div>
<p>Boruta identified 10 features (out of a potential 47) that we will retain in our FACET sample object for classification. Note that this feature selection process could be included in a general preprocessing pipeline, however due to the computation involved, we have utilized Boruta here as an initial one-off processing step to narrow down the features for our classifier development.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># update FACET sample object to only those features Boruta identified as useful</span>
<span class="n">prediab_initial_features</span> <span class="o">=</span> <span class="n">prediab</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">feature_names</span><span class="o">=</span><span class="n">selected</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Selecting-a-learner-using-FACET-ranker">
<h1>Selecting a learner using FACET ranker<a class="headerlink" href="#Selecting-a-learner-using-FACET-ranker" title="Permalink to this headline">¶</a></h1>
<p>FACET implements several additional useful wrappers which further simplify comparing and tuning a larger number of models and configurations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LearnerGrid</span></code>: allows you to pass a learner pipeline (i.e., classifier + any preprocessing) and a set of hyperparameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>: multiple LearnerGrids can be passed into this class as a list - this allows tuning hyperparameters both across different types of learners in a single step and ranks the resulting models accordingly</p></li>
</ul>
<p>The following learners and hyperparameter ranges will be assessed using 10 repeated 5-fold cross-validation:</p>
<ol class="arabic simple">
<li><p><strong>Random forest</strong>: with hyperparameters</p>
<ul class="simple">
<li><p>max_depth: [4, 5, 6]</p></li>
<li><p>min_samples_leaf: [8, 11, 15]</p></li>
</ul>
</li>
<li><p><strong>Light gradient boosting</strong>: with hyperparameters</p>
<ul class="simple">
<li><p>max_depth: [4, 5, 6]</p></li>
<li><p>min_samples_leaf: [8, 11, 15]</p></li>
</ul>
</li>
</ol>
<p>Note if you want to see a list of hyperparameters you can use <code class="docutils literal notranslate"><span class="pre">classifier_name().get_params().keys()</span></code> where <code class="docutils literal notranslate"><span class="pre">classifier_name</span></code> could be for example <code class="docutils literal notranslate"><span class="pre">RandomForestClassifierDF</span></code> and if you want to see the default values, just use <code class="docutils literal notranslate"><span class="pre">classifier_name().get_params()</span></code>.</p>
<p>Finally, for this exercise we will use AUC as the performance metric for scoring and ranking our classifiers (the default is accuracy). Note that ranking uses the average performance minus two times the standard deviation, so that we consider both the average performance and variability when selecting a classifier.</p>
<p>First, we specify the classifiers we want to train using <code class="docutils literal notranslate"><span class="pre">ClassifierPipelineDF</span></code> from sklearndf. Note here we also include the feature preprocessing steps we created earlier.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># random forest learner</span>
<span class="n">rforest_clf</span> <span class="o">=</span> <span class="n">ClassifierPipelineDF</span><span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">=</span><span class="n">preprocessing_features</span><span class="p">,</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">RandomForestClassifierDF</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># light gradient boosting learner</span>
<span class="n">lgbm_clf</span> <span class="o">=</span> <span class="n">ClassifierPipelineDF</span><span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">=</span><span class="n">preprocessing_features</span><span class="p">,</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">LGBMClassifierDF</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we create a list of learner grids where each learner grid is created using <code class="docutils literal notranslate"><span class="pre">LearnerGrid</span></code> and allows us to associate a <code class="docutils literal notranslate"><span class="pre">ClassifierPipelineDF</span></code> with a specified set of hyperparameter via the <code class="docutils literal notranslate"><span class="pre">learner_parameters</span></code> argument. Note this structure allows us to easily include additional classifiers and hyperparameters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">classifier_grid</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">LearnerGrid</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="n">rforest_clf</span><span class="p">,</span>
        <span class="n">learner_parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">),</span>
    <span class="n">LearnerGrid</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="n">lgbm_clf</span><span class="p">,</span>
        <span class="n">learner_parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="s2">&quot;min_child_samples&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>We now fit the grid defined above using the <code class="docutils literal notranslate"><span class="pre">LeanerRanker</span></code>, which will run a gridsearch (or random search if defined) using 10 repeated 5-fold cross-validation on our selected set of features from Boruta.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clf_ranker</span> <span class="o">=</span> <span class="n">LearnerRanker</span><span class="p">(</span>
    <span class="n">grids</span><span class="o">=</span><span class="n">classifier_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;roc_auc&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">prediab_initial_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can see how each model scored using the <code class="docutils literal notranslate"><span class="pre">summary_report()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># let&#39;s look at performance for the top ranked classifiers</span>
<span class="n">clf_ranker</span><span class="o">.</span><span class="n">summary_report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>ranking_score</th>
      <th colspan="2" halign="left">roc_auc</th>
      <th colspan="4" halign="left">classifier</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>type</th>
      <th>max_depth</th>
      <th>min_samples_leaf</th>
      <th>min_child_samples</th>
    </tr>
    <tr>
      <th>rank</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.660156</td>
      <td>0.723964</td>
      <td>0.031904</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.659307</td>
      <td>0.725083</td>
      <td>0.032888</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.658919</td>
      <td>0.725181</td>
      <td>0.033131</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.657712</td>
      <td>0.724385</td>
      <td>0.033337</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.657574</td>
      <td>0.723421</td>
      <td>0.032924</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.657130</td>
      <td>0.724306</td>
      <td>0.033588</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.656710</td>
      <td>0.723135</td>
      <td>0.033213</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.656219</td>
      <td>0.723038</td>
      <td>0.033410</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.655822</td>
      <td>0.723447</td>
      <td>0.033813</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.650737</td>
      <td>0.707240</td>
      <td>0.028251</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.646663</td>
      <td>0.701334</td>
      <td>0.027336</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.646067</td>
      <td>0.703763</td>
      <td>0.028848</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.645642</td>
      <td>0.705056</td>
      <td>0.029707</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.640766</td>
      <td>0.699109</td>
      <td>0.029171</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.640420</td>
      <td>0.696976</td>
      <td>0.028278</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.639798</td>
      <td>0.701004</td>
      <td>0.030603</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.638563</td>
      <td>0.696897</td>
      <td>0.029167</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.636719</td>
      <td>0.695454</td>
      <td>0.029368</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can see based on our learner ranker, we have selected a Random Forest algorithm that achieved a mean ROC AUC of 0.72 with a SD of 0.03.</p>
</div>
<div class="section" id="Using-FACET-for-advanced-model-inspection">
<h1>Using FACET for advanced model inspection<a class="headerlink" href="#Using-FACET-for-advanced-model-inspection" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions">SHAP approach</a> has become the standard method for model inspection. SHAP values are used to explain the additive contribution of each feature to the prediction for each observation (i.e., explain <strong>individual</strong> predictions).</p>
<p>The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> computes SHAP values for each crossfit (i.e., a CV fold or bootstrap resample) using the best model identified by the <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code>. The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> then provides advanced model inspection through new SHAP-based summary metrics for understanding pairwise feature redundancy and synergy. Redundancy and synergy are calculated using a new algorithm to understand model predictions from a <strong>global perspective</strong> to complement local SHAP.</p>
<p>The definitions of synergy and redundancy are as follows:</p>
<ul>
<li><p><strong>Synergy</strong></p>
<p>The degree to which the model combines information from one feature with another to predict the target. For example, let’s assume we are predicting cardiovascular health using age and gender and the fitted model includes a complex interaction between them. This means these two features are synergistic for predicting cardiovascular health. Further, both features are important to the model and removing either one would significantly impact performance. Let’s assume age brings more information
to the joint contribution than gender. This asymmetric contribution means the synergy for (age, gender) is less than the synergy for (gender, age). To think about it another way, imagine the prediction is a coordinate you are trying to reach. From your starting point, age gets you much closer to this point than gender, however, you need both to get there. Synergy reflects the fact that gender gets more help from age (higher synergy from the perspective of gender) than age does from gender
(lower synergy from the perspective of age) to reach the prediction. <em>This leads to an important point: synergy is a naturally asymmetric property of the global information two interacting features contribute to the model predictions.</em> Synergy is expressed as a percentage ranging from 0% (full autonomy) to 100% (full synergy).</p>
</li>
<li><p><strong>Redundancy</strong></p>
<p>The degree to which a feature in a model duplicates the information of a second feature to predict the target. For example, let’s assume we had house size and number of bedrooms for predicting house price. These features capture similar information as the more bedrooms the larger the house and likely a higher price on average. The redundancy for (number of bedrooms, house size) will be greater than the redundancy for (house size, number of bedrooms). This is because house size “knows” more of
what number of bedrooms does for predicting house price than vice-versa. Hence, there is greater redundancy from the perspective of number of bedrooms. Another way to think about it is removing house size will be more detrimental to model performance than removing number of bedrooms, as house size can better compensate for the absence of number of bedrooms. This also implies that house size would be a more important feature than number of bedrooms in the model. <em>The important point here is
that like synergy, redundancy is a naturally asymmetric property of the global information feature pairs have for predicting an outcome.</em> Redundancy is expressed as a percentage ranging from 0% (full uniqueness) to 100% (full redundancy).</p>
</li>
</ul>
<p>Note that cases can apply at the same time so a feature pair can use some information synergistically and some information redundantly.</p>
<p>The FACET <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> can calculate all of this with a single method call, but also offers methods to access the intermediate results of each step. A lightweight visualization framework is available to render the results in different styles.</p>
<p>SHAP values from the <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> can also be used with the SHAP package plotting functions for sample and observation level SHAP visualizations, such as SHAP distribution plots, dependency plots, force plots and waterfall plots.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run inspector</span>
<span class="n">clf_inspector</span> <span class="o">=</span> <span class="n">LearnerInspector</span><span class="p">(</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">crossfit</span><span class="o">=</span><span class="n">clf_ranker</span><span class="o">.</span><span class="n">best_model_crossfit_</span><span class="p">,</span> <span class="n">full_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Feature-importance">
<h2>Feature importance<a class="headerlink" href="#Feature-importance" title="Permalink to this headline">¶</a></h2>
<p>Feature importance has many ways of being measured. Here we utilize the FACET implementation based on the <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code>. Each feature is ranked according to the mean SHAP value for that feature. This plot is paired with a standard SHAP distribution plot for features to see if there is any directional tendency for the associations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># FACET feature importance</span>
<span class="n">f_importance</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">feature_importance</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">f_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">()</span>

<span class="c1"># get some info for standard SHAP model inspection</span>
<span class="n">shap_data</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">shap_plot_data</span><span class="p">()</span>

<span class="c1"># standard SHAP summary plot using the shap package</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="o">=</span><span class="n">shap_data</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">shap_data</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_size</span><span class="o">=</span><span class="p">(</span><span class="mf">16.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.sum(level=1) should use df.groupby(level=1).sum().
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.median(level=1) should use df.groupby(level=1).median().
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.sum(level=1) should use df.groupby(level=1).sum().
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.median(level=1) should use df.groupby(level=1).median().
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_38_1.png" src="../_images/tutorial_test_Classification_with_Facet_38_1.png" />
</div>
</div>
<p>Based on the feature importance’s we can see the top five features are age, RBC count, waist to height ratio, average systolic blood pressure and waist circumference. Inspection of the SHAP value distributions does not provide any indication of a general direction of association for any features.</p>
</div>
<div class="section" id="Synergy">
<h2>Synergy<a class="headerlink" href="#Synergy" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># synergy heatmap</span>
<span class="n">synergy_matrix</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">feature_synergy_matrix</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">synergy_matrix</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">synergy_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature synergies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_41_0.png" src="../_images/tutorial_test_Classification_with_Facet_41_0.png" />
</div>
</div>
<p>To interpret the synergy matrix, the first feature in a pair is the row (“perfill_diagonaltive from”), and the second feature the column. For example, for (<code class="docutils literal notranslate"><span class="pre">SBP_to_DBP</span></code>, <code class="docutils literal notranslate"><span class="pre">RBC_count</span></code>) from the perspective of <code class="docutils literal notranslate"><span class="pre">SBP_to_DBP</span></code> we find that 4.4% of the information is combined with <code class="docutils literal notranslate"><span class="pre">RBC_count</span></code> to predict prediabetes risk. This represents an example of little synergy between the feature pair from the perspective of <code class="docutils literal notranslate"><span class="pre">SBP_to_DBP</span></code>.</p>
<p>One interesting observation is that looking at the column for <code class="docutils literal notranslate"><span class="pre">Age</span></code>, we see from the perspective of other features such as <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">RBC</span> <span class="pre">count</span></code> and <code class="docutils literal notranslate"><span class="pre">SBP_to_DBP</span></code>, we see values ranging up to 8.4% suggesting a small amount of synergy. This is consistent with the idea that <code class="docutils literal notranslate"><span class="pre">Age</span></code> is a strong independent feature (it has the highest feature importance) and that contributions of <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">RBC</span> <span class="pre">count</span></code> and <code class="docutils literal notranslate"><span class="pre">SBP/DBP</span></code> to predicting prediabetes are partly enabled by <code class="docutils literal notranslate"><span class="pre">Age</span></code>.</p>
<p>We can inspect synergistic pairs of features more deeply using the <em>SHAP dependence plots</em> offered by the SHAP package. The <code class="docutils literal notranslate"><span class="pre">LearnerInspector</span></code> provides all data required for creating these and other plots through method <code class="docutils literal notranslate"><span class="pre">shap_plot_data()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">spd</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">shap_plot_data</span><span class="p">()</span>
<span class="n">shap</span><span class="o">.</span><span class="n">dependence_plot</span><span class="p">(</span><span class="s2">&quot;SBP_to_DBP&quot;</span><span class="p">,</span> <span class="n">spd</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">spd</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">interaction_index</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">dependence_plot</span><span class="p">(</span><span class="s2">&quot;BMI&quot;</span><span class="p">,</span> <span class="n">spd</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">spd</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">interaction_index</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_43_0.png" src="../_images/tutorial_test_Classification_with_Facet_43_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_43_1.png" src="../_images/tutorial_test_Classification_with_Facet_43_1.png" />
</div>
</div>
</div>
<div class="section" id="Redundancy">
<h2>Redundancy<a class="headerlink" href="#Redundancy" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># redundancy heatmap</span>
<span class="n">redundancy_matrix</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">feature_redundancy_matrix</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">redundancy_matrix</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">redundancy_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature redundancies&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%_dark&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">redundancy_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature redundancies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.sum(level=1) should use df.groupby(level=1).sum().
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.median(level=1) should use df.groupby(level=1).median().
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_45_1.png" src="../_images/tutorial_test_Classification_with_Facet_45_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_45_2.png" src="../_images/tutorial_test_Classification_with_Facet_45_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">MatrixDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplot%&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">redundancy_matrix</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Feature redundancies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_46_0.png" src="../_images/tutorial_test_Classification_with_Facet_46_0.png" />
</div>
</div>
<p>As with synergy, the matrix row is the “perspective from” feature in the row-column feature pair. Let’s take <code class="docutils literal notranslate"><span class="pre">Hematocrit</span></code> and <code class="docutils literal notranslate"><span class="pre">RBC</span> <span class="pre">count</span></code> as our features of interest. We can see that from the perspective of <code class="docutils literal notranslate"><span class="pre">Hematocrit</span></code> 35% of the information is duplicated with <code class="docutils literal notranslate"><span class="pre">RBC</span> <span class="pre">count</span></code> to predict prediabetes, and vice versa.</p>
<p>A second interesting and perhaps expected attribute of the heatmap is the apparent clustering of <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code>. Intuitively it makes sense that these features would have varying degrees of redundancy among them given they are physically related and the relationships with prediabetes risk.</p>
</div>
<div class="section" id="Feature-clustering">
<h2>Feature clustering<a class="headerlink" href="#Feature-clustering" title="Permalink to this headline">¶</a></h2>
<p>As detailed above redundancy and synergy for a feature pair is from the “perspective” of one of the features in the pair, and so yields two distinct values. However, a symmetric version can also be computed that provides not only a simplified perspective but allows the use of (1 - metric) as a feature distance. With this distance hierarchical, single linkage clustering is applied to create a dendrogram visualization. This helps to identify groups of low distance, features which activate “in
tandem” to predict the outcome. Such information can then be used to either reduce clusters of highly redundant features to a subset or highlight clusters of highly synergistic features that should always be considered together.</p>
<p>For this example, let’s apply clustering to redundancy to see how the apparent grouping observed in the heatmap appears in the dendrogram. Ideally, we want to see features only start to cluster as close to the right-hand side of the dendrogram as possible. This implies all features in the model are contributing uniquely to our predictions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># redundancy dendrogram</span>
<span class="n">dd_redundancy</span> <span class="o">=</span> <span class="n">clf_inspector</span><span class="o">.</span><span class="n">feature_redundancy_linkage</span><span class="p">()</span>
<span class="n">DendrogramDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dd_redundancy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_49_0.png" src="../_images/tutorial_test_Classification_with_Facet_49_0.png" />
</div>
</div>
<p>The dendrogram shows that <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code> cluster together first, which then cluster with <code class="docutils literal notranslate"><span class="pre">BMI</span></code> as well. This is a much clearer representation of the cluster of redundant features we observed in the heatmap. Considering <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code>:</p>
<p><strong>What might we infer from synergy, redundancy and redundancy feature clustering?</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code> form a small cluster of redundant features. This seems reasonable:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> is included in the calculation of <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code></p></li>
<li><p>we might expect <code class="docutils literal notranslate"><span class="pre">BMI</span></code> to capture similar information about excess body mass as higher <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code></p></li>
</ul>
</li>
<li><p>We saw little synergy between features. We might have expected apriori to find some interesting synergies between diet, exercise, sleep and body composition. Of course, the model needs to identify these relationships from them to be reflected in the synergy metric(s).</p></li>
</ol>
<p><strong>What action(s) might we take?</strong></p>
<p>Given the redundancy that appears between <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code>, we could look to eliminate one or two of these features from the model.</p>
<p>For convenience when working in a non-notebook environment, all of the <code class="docutils literal notranslate"><span class="pre">Drawer</span></code>’s provided by the <a class="reference external" href="https://github.com/BCG-Gamma/pytools">pytools</a> package also support a <code class="docutils literal notranslate"><span class="pre">style='text'</span></code> flag.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DendrogramDrawer</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dd_redundancy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================== Redundancy linkage ==============================
BMI              5% ---------------------------\
Waist_to_hgt    11% -------------------\_______/---------------------------\
Waist_Circumfer  8% -------------------/                                   |
Gamma_glutamyl_  7% ------------------------------------------------------\|\
Uric_acid        7% -----------------------------------------------------\|/|__
RBC_count       12% ------------------------------------------\__________// |
Hematocrit       5% ------------------------------------------/             |
Age             31% -------------------------------------------------------\|
Average_SBP     10% ------------------------------------------------------\//
SBP_to_DBP       4% ------------------------------------------------------/


</pre></div></div>
</div>
</div>
<div class="section" id="Removing-redundant-features">
<h2>Removing redundant features<a class="headerlink" href="#Removing-redundant-features" title="Permalink to this headline">¶</a></h2>
<p>Recall the redundancy dendrogram above where we saw a clear cluster of features with redundancy; <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code>, <code class="docutils literal notranslate"><span class="pre">BMI</span></code>, and <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code>.</p>
<ul class="simple">
<li><p>assess if the features of the model are unique, i.e. not redundant with other features</p></li>
<li><p>decide which features to discard, combine, or modify to increase the uniqueness of important features in the model</p></li>
</ul>
<p>Before we proceed to looking at SHAP values for individual predictions and perform a univariate simulation, let’s eliminate two partially redundant features - we will choose to keep <code class="docutils literal notranslate"><span class="pre">Waist/Height</span></code> ratio and drop <code class="docutils literal notranslate"><span class="pre">BMI</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># drop redundant features from our FACET sample object</span>
<span class="n">prediab_no_redundant_feat</span> <span class="o">=</span> <span class="n">prediab_initial_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;BMI&quot;</span><span class="p">,</span> <span class="s2">&quot;Waist_Circumference&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># re-run ranker without redundant features</span>
<span class="n">clf_ranker_no_redun</span> <span class="o">=</span> <span class="n">LearnerRanker</span><span class="p">(</span>
    <span class="n">grids</span><span class="o">=</span><span class="n">classifier_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;roc_auc&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">prediab_no_redundant_feat</span><span class="p">)</span>

<span class="n">clf_ranker_no_redun</span><span class="o">.</span><span class="n">summary_report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>ranking_score</th>
      <th colspan="2" halign="left">roc_auc</th>
      <th colspan="4" halign="left">classifier</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>type</th>
      <th>max_depth</th>
      <th>min_samples_leaf</th>
      <th>min_child_samples</th>
    </tr>
    <tr>
      <th>rank</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.665617</td>
      <td>0.729985</td>
      <td>0.032184</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.663938</td>
      <td>0.729144</td>
      <td>0.032603</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.663762</td>
      <td>0.729272</td>
      <td>0.032755</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.662951</td>
      <td>0.728367</td>
      <td>0.032708</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.662736</td>
      <td>0.728134</td>
      <td>0.032699</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.662633</td>
      <td>0.729057</td>
      <td>0.033212</td>
      <td>RandomForestClassifierDF</td>
      <td>6</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.662204</td>
      <td>0.728217</td>
      <td>0.033007</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>11.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.660693</td>
      <td>0.728214</td>
      <td>0.033760</td>
      <td>RandomForestClassifierDF</td>
      <td>5</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.660454</td>
      <td>0.726967</td>
      <td>0.033257</td>
      <td>RandomForestClassifierDF</td>
      <td>4</td>
      <td>15.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.652143</td>
      <td>0.713877</td>
      <td>0.030867</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.648936</td>
      <td>0.710197</td>
      <td>0.030630</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.648609</td>
      <td>0.705542</td>
      <td>0.028467</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.646755</td>
      <td>0.709422</td>
      <td>0.031334</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.642874</td>
      <td>0.705524</td>
      <td>0.031325</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.638764</td>
      <td>0.707031</td>
      <td>0.034133</td>
      <td>LGBMClassifierDF</td>
      <td>4</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.638494</td>
      <td>0.700547</td>
      <td>0.031026</td>
      <td>LGBMClassifierDF</td>
      <td>5</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.638179</td>
      <td>0.704848</td>
      <td>0.033335</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.633699</td>
      <td>0.697161</td>
      <td>0.031731</td>
      <td>LGBMClassifierDF</td>
      <td>6</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run inspector</span>
<span class="n">inspector_no_redun</span> <span class="o">=</span> <span class="n">LearnerInspector</span><span class="p">(</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">crossfit</span><span class="o">=</span><span class="n">clf_ranker_no_redun</span><span class="o">.</span><span class="n">best_model_crossfit_</span><span class="p">,</span> <span class="n">full_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># redundancy dendrogram</span>
<span class="n">dd_redundancy</span> <span class="o">=</span> <span class="n">inspector_no_redun</span><span class="o">.</span><span class="n">feature_redundancy_linkage</span><span class="p">()</span>
<span class="n">DendrogramDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage (reduced feature set)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dd_redundancy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">DendrogramDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Redundancy linkage (reduced feature set, sorted)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dd_redundancy</span><span class="o">.</span><span class="n">sort_by_weight</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.sum(level=1) should use df.groupby(level=1).sum().
Using the level keyword in DataFrame and Series aggregations is deprecated and will be removed in a future version. Use groupby instead. df.median(level=1) should use df.groupby(level=1).median().
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_57_1.png" src="../_images/tutorial_test_Classification_with_Facet_57_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_57_2.png" src="../_images/tutorial_test_Classification_with_Facet_57_2.png" />
</div>
</div>
<p>Now with the removal of <code class="docutils literal notranslate"><span class="pre">BMI</span></code> and <code class="docutils literal notranslate"><span class="pre">Waist</span> <span class="pre">Circumference</span></code> we can see the feature clustering starts much further to the right.</p>
<p>We can also check the best ranked model after removing redundant features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clf_ranker</span><span class="o">.</span><span class="n">best_model_</span><span class="o">.</span><span class="n">classifier</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestClassifierDF(max_depth=4, min_samples_leaf=11, random_state=42)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="FACET-univariate-simulator:-the-impact-of-waist-to-height-ratio">
<h1>FACET univariate simulator: the impact of waist to height ratio<a class="headerlink" href="#FACET-univariate-simulator:-the-impact-of-waist-to-height-ratio" title="Permalink to this headline">¶</a></h1>
<p>Another advantage of FACET is the ability to quickly instigate and run univariate simulation. Simulation enables us to gain insight into what value(s) of this ratio might minimize the likelihood of prediabetes.</p>
<p>As the basis for the simulation, we divide the feature into relevant partitions:</p>
<ul class="simple">
<li><p>We use FACET’s <code class="docutils literal notranslate"><span class="pre">ContinuousRangePartitioner</span></code> to split the range of observed values of waist to height ratio into intervals of equal size. Each partition is represented by the central value of that partition.</p></li>
<li><p>For each partition, the simulator creates an artificial copy of the original sample assuming the variable to be simulated has the same value across all observations - which is the value representing the partition. Using the best <code class="docutils literal notranslate"><span class="pre">LearnerCrossfit</span></code> acquired from the ranker, the simulator now re-predicts all targets using the models trained for all folds and determines the average value of the target variable resulting from this.</p></li>
<li><p>The FACET <code class="docutils literal notranslate"><span class="pre">SimulationDrawer</span></code> allows us to visualise the result; both in a matplotlib and a plain-text style</p></li>
</ul>
<p>Finally, because FACET can use bootstrap cross validation, we can create a crossfit from our previous <code class="docutils literal notranslate"><span class="pre">LearnerRanker</span></code> best model to perform the simulation so we can quantify the uncertainty by using bootstrap confidence intervals.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a bootstrap CV crossfit for simulation using best model</span>
<span class="n">boot_crossfit</span> <span class="o">=</span> <span class="n">LearnerCrossfit</span><span class="p">(</span>
    <span class="n">pipeline</span><span class="o">=</span><span class="n">clf_ranker</span><span class="o">.</span><span class="n">best_model_</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">BootstrapCV</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">prediab_no_redundant_feat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># set up and run a simulation</span>
<span class="n">sim_feature</span> <span class="o">=</span> <span class="s2">&quot;Waist_to_hgt&quot;</span>

<span class="n">waist_to_hgt_simulator</span> <span class="o">=</span> <span class="n">UnivariateProbabilitySimulator</span><span class="p">(</span>
    <span class="n">crossfit</span><span class="o">=</span><span class="n">boot_crossfit</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">waist_to_hgt_simulator</span><span class="o">.</span><span class="n">full_sample</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">waist_to_hgt_partitions</span> <span class="o">=</span> <span class="n">ContinuousRangePartitioner</span><span class="p">(</span><span class="n">max_partitions</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">waist_to_hgt_simulation</span> <span class="o">=</span> <span class="n">waist_to_hgt_simulator</span><span class="o">.</span><span class="n">simulate_feature</span><span class="p">(</span>
    <span class="n">feature_name</span><span class="o">=</span><span class="n">sim_feature</span><span class="p">,</span>
    <span class="n">partitioner</span><span class="o">=</span><span class="n">waist_to_hgt_partitions</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># visualize the results</span>
<span class="n">SimulationDrawer</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">waist_to_hgt_simulation</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">sim_feature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_64_0.png" src="../_images/tutorial_test_Classification_with_Facet_64_0.png" />
</div>
</div>
<p>As we can see the simulation shows that higher waist to height ratios are associated with an increased risk of prediabetes. We could also suggest that keeping a person’s waist to height ratio below 0.52 may reduce the likelihood of prediabetes from around 34% to 30%.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># can also get a print out of simulation results</span>
<span class="n">SimulationDrawer</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">waist_to_hgt_simulation</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">sim_feature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================================= Waist_to_hgt =================================

probability(1):

Baseline = 0.342

Partition  2.5th percentile  Median     97.5th percentile
=========  ================  =========  =================
0.38               0.285      0.293              0.301
0.4                0.285      0.293              0.301
0.42               0.285      0.293              0.301
0.44               0.289      0.297              0.305
0.46               0.293      0.301              0.309
0.48               0.293      0.301              0.31
0.5                0.294      0.302              0.311
0.52               0.295      0.304              0.312
0.54               0.306      0.314              0.322
0.56               0.304      0.313              0.321
0.58               0.357      0.366              0.374
0.6                0.352      0.36               0.369
0.62               0.354      0.363              0.371
0.64               0.357      0.365              0.373
0.66               0.365      0.373              0.381
0.68               0.386      0.394              0.402
0.7                0.4        0.408              0.416
0.72               0.405      0.413              0.42
0.74               0.404      0.412              0.42
0.76               0.407      0.414              0.422
0.78               0.407      0.414              0.422
0.8                0.407      0.414              0.422
0.82               0.407      0.414              0.422

Observed frequencies:

Partition  Frequency
=========  =========
0.38               1
0.4                9
0.42              21
0.44              42
0.46              52
0.48              68
0.5               47
0.52              79
0.54              82
0.56              89
0.58              86
0.6               75
0.62              61
0.64              59
0.66              48
0.68              37
0.7               22
0.72              21
0.74              23
0.76              14
0.78              11
0.8                7
0.82               6

</pre></div></div>
</div>
</div>
<div class="section" id="Summary">
<h1>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h1>
<p>With the capabilities offered by FACET we were able to:</p>
<ol class="arabic simple">
<li><p>Identify a learner with performance comparable to models in the literature.</p></li>
<li><p>Utilize advanced the SHAP value capabilities (synergy and redundancy) to identify additional features that could be removed (i.e., BMI and waist circumference removed in favour of waist to height ratio) and whether any features had strong synergistic effects - which they did not.</p></li>
<li><p>Simulate the effect of changes in waist to height ratio on the likelihood of being prediabetic.</p></li>
</ol>
</div>
<div class="section" id="What-can-you-do-next?">
<h1>What can you do next?<a class="headerlink" href="#What-can-you-do-next?" title="Permalink to this headline">¶</a></h1>
<p>There are several next/alternative steps that could be taken:</p>
<ol class="arabic simple">
<li><p>Utilize methods to deal with class imbalance and see if it improves the model.</p></li>
<li><p>Adding more features! The NHANES data is a treasure trove of information.</p></li>
<li><p>Retain diabetic patients and convert it into a multi-class learning problem.</p></li>
<li><p>What would happen if we applied survey weights when constructing a learner?</p></li>
<li><p>Further investigation of feature engineering. One could also look at different sets of measurements such as the bio-profile and perform dimension reduction first via PCA or some other method.</p></li>
<li><p>Other learners such as SVC, LDA, Elastic-Net, CNN.</p></li>
<li><p>More sophisticated imputation for missing values: the assumption of MAR might not hold, as those with worse health and thus more at risk of prediabetes may be more likely not to disclose poor health characteristics. Methods enabled by IterativeImputer could be used or even KNNImputer. Also feature engineering could be done post imputation in the pipeline, so values such as ratios are consistent.</p></li>
</ol>
</div>
<div class="section" id="Appendix">
<h1>Appendix<a class="headerlink" href="#Appendix" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Data-source-and-study-cohort">
<h2>Data source and study cohort<a class="headerlink" href="#Data-source-and-study-cohort" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>Introduction</strong></div>
<div class="line">Prediabetes is a treatable condition that leads to many health complications, including eventually type 2 diabetes. Prediabetes has become an epidemic worldwide and is increasing in prevalence. As a largely asymptomatic condition, screening for prediabetes can be extremely challenging. However, early intervention, especially with lifestyle changes has been shown as effective in treating prediabetes. Accurate prediction/identification of those individuals at risk of prediabetes can improve
early intervention and may provide insights into those interventions that work best. The current standard of care is a CDC prediabetes risk <a class="reference external" href="https://www.cdc.gov/diabetes/prevention/pdf/Prediabetes-Risk-Test-Final.pdf">screening tool</a>.</div>
</div>
<div class="line-block">
<div class="line"><strong>Data source</strong></div>
<div class="line">The dataset used in this tutorial is derived from the <a class="reference external" href="https://wwwn.cdc.gov/nchs/nhanes/Search/DataPage.aspx?Component=Examination&amp;CycleBeginYear=2013">National Health and Nutrition Examination Survey (NHANES) 2013-14 cross-sectional survey</a>. In brief, NHANES collects demographic, socioeconomic, dietary, health, medical, dental, physiological and laboratory data on a nationally representative sample of noninstitutionalized, civilian United States residents. Please note the set-up for this
data loosely follows the approach in <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/31889178/">De Silva et al</a>.</div>
</div>
<div class="line-block">
<div class="line"><strong>Patient cohort</strong></div>
<div class="line">In the NHANES data sub-sets of those surveyed may undergo a plasma glucose (FPG) test, oral glucose tolerance test (OGTT), or have glycated haemoglobin (HbA1c) measured. Diabetic patients were defined as those with any of the following: FPG &gt;= 126 mg/dl, OGTT &gt; 200 mg/dl, HbA1c &gt; 6.4% or a Doctor diagnosed diabetes. The created dataset contains selected information for 4356 patients aged 20 years or over who were not considered diabetic or who were not pregnant or suspected to be pregnant at
the time of the survey.</div>
</div>
<div class="line-block">
<div class="line"><strong>Learning target: prediabetes status</strong></div>
<div class="line">Using any of the available FPG, OGTT and HbA1c tests we defined patients as prediabetic where any of the following was satisfied: FPG 100–125 mg/dl, OGTT 140–200 mg/dl, or HbA1c 5.7–6.4%. Among this cohort 35% were prediabetic (n=1509).</div>
</div>
<div class="line-block">
<div class="line"><strong>Initial features</strong></div>
<div class="line">The following tables provides an overview of the 37 features included in the example dataset.</div>
</div>
<table class="table">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Instrument</p></th>
<th class="head"><p>Data File Name (File)</p></th>
<th class="head"><p>NHANES Field</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Dataset name</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Demographics</p></td>
<td><p>Demographic Variables, Sample Weights (DEMO_H)</p></td>
<td><p>RIDAGEYR</p></td>
<td><p>Age in years at screening</p></td>
<td><p>Age</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Demographics</p></td>
<td><p>Demographic Variables, Sample Weights (DEMO_H)</p></td>
<td><p>RIAGENDR</p></td>
<td><p>Gender</p></td>
<td><p>Gender</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Examination</p></td>
<td><p>Body Measures (BMX_H)</p></td>
<td><p>BMXWT</p></td>
<td><p>Weight (kg)</p></td>
<td><p>Weight</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Examination</p></td>
<td><p>Body Measures (BMX_H)</p></td>
<td><p>BMXHT</p></td>
<td><p>Standing Height (cm)</p></td>
<td><p>Standing_Height</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Examination</p></td>
<td><p>Body Measures (BMX_H)</p></td>
<td><p>BMXWAIST</p></td>
<td><p>Waist Circumference (cm)</p></td>
<td><p>Waist_Circumference</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Examination</p></td>
<td><p>Body Measures (BMX_H)</p></td>
<td><p>BMXBMI</p></td>
<td><p>Body Mass Index (kg/m^2)</p></td>
<td><p>BMI</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Examination</p></td>
<td><p>Blood Pressure (BPX_H)</p></td>
<td><p>BPXSY1 to 4</p></td>
<td><p>Systolic: Blood pres mm Hg</p></td>
<td><p>Average_SBP</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Examination</p></td>
<td><p>Blood Pressure (BPX_H)</p></td>
<td><p>BPXDI1 to 4</p></td>
<td><p>Diastolic: Blood pres mm Hg</p></td>
<td><p>Average_DBP</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Blood Pressure &amp; Cholesterol (BPQ_H)</p></td>
<td><p>BPQ020</p></td>
<td><p>Ever told you had high blood pressure</p></td>
<td><p>High_BP</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Diet Behavior &amp; Nutrition (DBQ_H)</p></td>
<td><p>DBQ700</p></td>
<td><p>How healthy is the diet</p></td>
<td><p>Healthy_diet</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Diabetes (DIQ_H)</p></td>
<td><p>DIQ175A</p></td>
<td><p>Family history</p></td>
<td><p>Family_hist_diab</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Diabetes (DIQ_H)</p></td>
<td><p>DIQ172</p></td>
<td><p>Feel could be at risk for diabetes</p></td>
<td><p>Feel_at_risk_diab</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Current Health Status (HSQ_H)</p></td>
<td><p>HSD010</p></td>
<td><p>General health condition</p></td>
<td><p>General_health</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Medical Conditions (MCQ_H)</p></td>
<td><p>MCQ080</p></td>
<td><p>Doctor ever said you were overweight</p></td>
<td><p>Told_overweight</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Physical Activity (PAQ_H)</p></td>
<td><p>PAQ605</p></td>
<td><p>Vigorous work activity</p></td>
<td><p>Vigorous_work_activity</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Physical Activity (PAQ_H)</p></td>
<td><p>PAQ620</p></td>
<td><p>Moderate work activity</p></td>
<td><p>Moderate_work_activity</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Physical Activity (PAQ_H)</p></td>
<td><p>PAQ635</p></td>
<td><p>Walk or bicycle</p></td>
<td><p>Walk_or_bicycle</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Physical Activity (PAQ_H)</p></td>
<td><p>PAQ650</p></td>
<td><p>Vigorous recreational activities</p></td>
<td><p>Vigorous_rec_activity</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Physical Activity (PAQ_H)</p></td>
<td><p>PAQ665</p></td>
<td><p>Moderate recreational activities</p></td>
<td><p>Moderate_rec_activity</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Sleep Disorders (SLQ_H)</p></td>
<td><p>SLD010H</p></td>
<td><p>How much sleep do you get (hours)?</p></td>
<td><p>Sleep_hours</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Sleep Disorders (SLQ_H)</p></td>
<td><p>SLQ050</p></td>
<td><p>Ever told doctor had trouble sleeping?</p></td>
<td><p>Trouble_sleeping</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Questionnaire</p></td>
<td><p>Sleep Disorders (SLQ_H)</p></td>
<td><p>SLQ060</p></td>
<td><p>Ever told by doctor have sleep disorder?</p></td>
<td><p>Sleep_disorder</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-even"><td><p>Questionnaire</p></td>
<td><p>Weight History (WHQ_H)</p></td>
<td><p>WHQ070</p></td>
<td><p>Tried to lose weight in past year</p></td>
<td><p>Tried_weight_loss_past_year</p></td>
<td><p>Categorical</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Cholesterol HDL (HDL_H)</p></td>
<td><p>LBDHDD</p></td>
<td><p>Direct HDL-Cholesterol (mg/dL)</p></td>
<td><p>HDL_Cholesterol</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Cholesterol Total (TCHOL_H)</p></td>
<td><p>LBXTC</p></td>
<td><p>Total Cholesterol(mg/dL)</p></td>
<td><p>Total_Cholesterol</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Complete Blood Count (CBC_H)</p></td>
<td><p>LBXWBCSI</p></td>
<td><p>White blood cell count (1000 cells/uL)</p></td>
<td><p>WBC_count</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Complete Blood Count (CBC_H)</p></td>
<td><p>LBXRBCSI</p></td>
<td><p>Red blood cell count (million cells/uL)</p></td>
<td><p>RBC_count</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Complete Blood Count (CBC_H)</p></td>
<td><p>LBXHCT</p></td>
<td><p>Haematocrit (%)</p></td>
<td><p>Haematocrit</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSTR</p></td>
<td><p>Triglycerides (mg/dL)</p></td>
<td><p>Triglycerides</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSUA</p></td>
<td><p>Uric acid (mg/dL)</p></td>
<td><p>Uric_acid</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSOSSI</p></td>
<td><p>Osmolality (mmol/Kg)</p></td>
<td><p>Osmolality</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSNASI</p></td>
<td><p>Sodium (mmol/L)</p></td>
<td><p>Sodium</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSKSI</p></td>
<td><p>Potassium (mmol/L)</p></td>
<td><p>Potassium</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSGTSI</p></td>
<td><p>Gamma glutamyl transferase (U/L)</p></td>
<td><p>Gamma_glutamyl_transferase</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSCA</p></td>
<td><p>Total calcium (mg/dL)</p></td>
<td><p>Calcium</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-odd"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSATSI</p></td>
<td><p>Alanine aminotransferase ALT (IU/L)</p></td>
<td><p>Alanine_aminotransferase</p></td>
<td><p>Numeric</p></td>
</tr>
<tr class="row-even"><td><p>Laboratory</p></td>
<td><p>Biochemistry Profile (BIOPRO_H)</p></td>
<td><p>LBXSASSI</p></td>
<td><p>Aspartate aminotransferase AST (IU/L)</p></td>
<td><p>Aspartate_aminotransferase</p></td>
<td><p>Numeric</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Exploratory-Data-Analysis-(EDA)">
<h2>Exploratory Data Analysis (EDA)<a class="headerlink" href="#Exploratory-Data-Analysis-(EDA)" title="Permalink to this headline">¶</a></h2>
<p>Let’s begin by doing some brief exploratory data analysis to assess the impact features might have on the likelihood someone is prediabetic and to also determine what will need to be addressed in a preprocessing pipeline.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load the prepared data frame</span>
<span class="n">prediab_eda</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;pre_diab_nhanes.csv&quot;</span><span class="p">)</span>
<span class="n">prediab_eda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>Waist_Circumference</th>
      <th>Weight</th>
      <th>Standing_Height</th>
      <th>BMI</th>
      <th>Average_SBP</th>
      <th>Average_DBP</th>
      <th>HDL_Cholesterol</th>
      <th>Total_Cholesterol</th>
      <th>...</th>
      <th>Triglycerides</th>
      <th>Uric_acid</th>
      <th>Osmolality</th>
      <th>Sodium</th>
      <th>Potassium</th>
      <th>Gamma_glutamyl_transferase</th>
      <th>Calcium</th>
      <th>Alanine_aminotransferase</th>
      <th>Aspartate_aminotransferase</th>
      <th>Pre_diab</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>73.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>162.4</td>
      <td>19.7</td>
      <td>137.333333</td>
      <td>86.666667</td>
      <td>85.0</td>
      <td>201.0</td>
      <td>...</td>
      <td>88.0</td>
      <td>4.2</td>
      <td>290.0</td>
      <td>142.0</td>
      <td>4.1</td>
      <td>31.0</td>
      <td>10.0</td>
      <td>28.0</td>
      <td>36.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>56.0</td>
      <td>1.0</td>
      <td>123.1</td>
      <td>105.0</td>
      <td>158.7</td>
      <td>41.7</td>
      <td>157.333333</td>
      <td>82.000000</td>
      <td>38.0</td>
      <td>226.0</td>
      <td>...</td>
      <td>327.0</td>
      <td>9.1</td>
      <td>287.0</td>
      <td>143.0</td>
      <td>3.3</td>
      <td>22.0</td>
      <td>9.3</td>
      <td>16.0</td>
      <td>24.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>61.0</td>
      <td>2.0</td>
      <td>110.8</td>
      <td>93.4</td>
      <td>161.8</td>
      <td>35.7</td>
      <td>122.666667</td>
      <td>80.666667</td>
      <td>58.0</td>
      <td>168.0</td>
      <td>...</td>
      <td>68.0</td>
      <td>5.1</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>3.9</td>
      <td>17.0</td>
      <td>9.9</td>
      <td>21.0</td>
      <td>20.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>56.0</td>
      <td>2.0</td>
      <td>85.5</td>
      <td>61.8</td>
      <td>152.8</td>
      <td>26.5</td>
      <td>122.000000</td>
      <td>72.666667</td>
      <td>59.0</td>
      <td>278.0</td>
      <td>...</td>
      <td>262.0</td>
      <td>3.5</td>
      <td>277.0</td>
      <td>139.0</td>
      <td>4.0</td>
      <td>21.0</td>
      <td>9.5</td>
      <td>24.0</td>
      <td>23.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>65.0</td>
      <td>1.0</td>
      <td>93.7</td>
      <td>65.3</td>
      <td>172.4</td>
      <td>22.0</td>
      <td>141.333333</td>
      <td>77.333333</td>
      <td>79.0</td>
      <td>173.0</td>
      <td>...</td>
      <td>39.0</td>
      <td>6.3</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>4.8</td>
      <td>24.0</td>
      <td>9.5</td>
      <td>20.0</td>
      <td>29.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 38 columns</p>
</div></div>
</div>
<p>We might also consider some rudimentary feature engineering as well, such as the ratio of waist circumference to height or the ratio of systolic to diastolic blood pressure. Let’s create these two features as well.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;SBP_to_DBP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;Average_SBP&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;Average_DBP&quot;</span><span class="p">]</span>
<span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;Waist_to_hgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;Waist_Circumference&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">prediab_eda</span><span class="p">[</span><span class="s2">&quot;Standing_Height&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">prediab_eda</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>Waist_Circumference</th>
      <th>Weight</th>
      <th>Standing_Height</th>
      <th>BMI</th>
      <th>Average_SBP</th>
      <th>Average_DBP</th>
      <th>HDL_Cholesterol</th>
      <th>Total_Cholesterol</th>
      <th>...</th>
      <th>Osmolality</th>
      <th>Sodium</th>
      <th>Potassium</th>
      <th>Gamma_glutamyl_transferase</th>
      <th>Calcium</th>
      <th>Alanine_aminotransferase</th>
      <th>Aspartate_aminotransferase</th>
      <th>Pre_diab</th>
      <th>SBP_to_DBP</th>
      <th>Waist_to_hgt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>73.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>162.4</td>
      <td>19.7</td>
      <td>137.333333</td>
      <td>86.666667</td>
      <td>85.0</td>
      <td>201.0</td>
      <td>...</td>
      <td>290.0</td>
      <td>142.0</td>
      <td>4.1</td>
      <td>31.0</td>
      <td>10.0</td>
      <td>28.0</td>
      <td>36.0</td>
      <td>1</td>
      <td>1.584615</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>56.0</td>
      <td>1.0</td>
      <td>123.1</td>
      <td>105.0</td>
      <td>158.7</td>
      <td>41.7</td>
      <td>157.333333</td>
      <td>82.000000</td>
      <td>38.0</td>
      <td>226.0</td>
      <td>...</td>
      <td>287.0</td>
      <td>143.0</td>
      <td>3.3</td>
      <td>22.0</td>
      <td>9.3</td>
      <td>16.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>1.918699</td>
      <td>0.775677</td>
    </tr>
    <tr>
      <th>2</th>
      <td>61.0</td>
      <td>2.0</td>
      <td>110.8</td>
      <td>93.4</td>
      <td>161.8</td>
      <td>35.7</td>
      <td>122.666667</td>
      <td>80.666667</td>
      <td>58.0</td>
      <td>168.0</td>
      <td>...</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>3.9</td>
      <td>17.0</td>
      <td>9.9</td>
      <td>21.0</td>
      <td>20.0</td>
      <td>1</td>
      <td>1.520661</td>
      <td>0.684796</td>
    </tr>
    <tr>
      <th>3</th>
      <td>56.0</td>
      <td>2.0</td>
      <td>85.5</td>
      <td>61.8</td>
      <td>152.8</td>
      <td>26.5</td>
      <td>122.000000</td>
      <td>72.666667</td>
      <td>59.0</td>
      <td>278.0</td>
      <td>...</td>
      <td>277.0</td>
      <td>139.0</td>
      <td>4.0</td>
      <td>21.0</td>
      <td>9.5</td>
      <td>24.0</td>
      <td>23.0</td>
      <td>0</td>
      <td>1.678899</td>
      <td>0.559555</td>
    </tr>
    <tr>
      <th>4</th>
      <td>65.0</td>
      <td>1.0</td>
      <td>93.7</td>
      <td>65.3</td>
      <td>172.4</td>
      <td>22.0</td>
      <td>141.333333</td>
      <td>77.333333</td>
      <td>79.0</td>
      <td>173.0</td>
      <td>...</td>
      <td>281.0</td>
      <td>140.0</td>
      <td>4.8</td>
      <td>24.0</td>
      <td>9.5</td>
      <td>20.0</td>
      <td>29.0</td>
      <td>0</td>
      <td>1.827586</td>
      <td>0.543503</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># first a quick look at features overall</span>
<span class="n">prediab_eda</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Age</th>
      <td>4356.0</td>
      <td>47.044536</td>
      <td>17.188703</td>
      <td>20.000000</td>
      <td>33.000000</td>
      <td>45.000000</td>
      <td>61.000000</td>
      <td>80.000000</td>
    </tr>
    <tr>
      <th>Gender</th>
      <td>4356.0</td>
      <td>1.521350</td>
      <td>0.499601</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>Waist_Circumference</th>
      <td>4158.0</td>
      <td>97.167268</td>
      <td>15.799909</td>
      <td>55.500000</td>
      <td>85.900000</td>
      <td>95.500000</td>
      <td>106.500000</td>
      <td>177.900000</td>
    </tr>
    <tr>
      <th>Weight</th>
      <td>4321.0</td>
      <td>79.939968</td>
      <td>21.135093</td>
      <td>32.300000</td>
      <td>65.100000</td>
      <td>76.900000</td>
      <td>91.100000</td>
      <td>222.600000</td>
    </tr>
    <tr>
      <th>Standing_Height</th>
      <td>4318.0</td>
      <td>167.369701</td>
      <td>10.158315</td>
      <td>136.300000</td>
      <td>160.000000</td>
      <td>167.100000</td>
      <td>174.500000</td>
      <td>199.400000</td>
    </tr>
    <tr>
      <th>BMI</th>
      <td>4314.0</td>
      <td>28.446639</td>
      <td>6.793577</td>
      <td>14.100000</td>
      <td>23.700000</td>
      <td>27.300000</td>
      <td>31.800000</td>
      <td>82.900000</td>
    </tr>
    <tr>
      <th>Average_SBP</th>
      <td>4229.0</td>
      <td>121.893671</td>
      <td>17.271841</td>
      <td>64.666667</td>
      <td>110.000000</td>
      <td>118.666667</td>
      <td>131.333333</td>
      <td>228.000000</td>
    </tr>
    <tr>
      <th>Average_DBP</th>
      <td>4222.0</td>
      <td>70.280515</td>
      <td>11.039221</td>
      <td>22.666667</td>
      <td>63.333333</td>
      <td>70.666667</td>
      <td>77.333333</td>
      <td>128.000000</td>
    </tr>
    <tr>
      <th>HDL_Cholesterol</th>
      <td>4318.0</td>
      <td>53.723020</td>
      <td>16.240125</td>
      <td>10.000000</td>
      <td>42.000000</td>
      <td>51.000000</td>
      <td>63.000000</td>
      <td>173.000000</td>
    </tr>
    <tr>
      <th>Total_Cholesterol</th>
      <td>4318.0</td>
      <td>190.363131</td>
      <td>39.631288</td>
      <td>69.000000</td>
      <td>163.000000</td>
      <td>188.000000</td>
      <td>214.000000</td>
      <td>525.000000</td>
    </tr>
    <tr>
      <th>High_BP</th>
      <td>4355.0</td>
      <td>0.320321</td>
      <td>0.466654</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Sleep_hours</th>
      <td>4352.0</td>
      <td>6.882812</td>
      <td>1.389642</td>
      <td>2.000000</td>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>8.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>Trouble_sleeping</th>
      <td>4354.0</td>
      <td>0.249426</td>
      <td>0.432730</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Sleep_disorder</th>
      <td>4346.0</td>
      <td>0.085826</td>
      <td>0.280139</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Told_overweight</th>
      <td>4354.0</td>
      <td>0.310978</td>
      <td>0.462947</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>General_health</th>
      <td>4016.0</td>
      <td>2.739293</td>
      <td>0.952422</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>Family_hist_diab</th>
      <td>4356.0</td>
      <td>0.219238</td>
      <td>0.413778</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Feel_at_risk_diab</th>
      <td>4311.0</td>
      <td>0.288564</td>
      <td>0.453147</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Vigorous_work_activity</th>
      <td>4355.0</td>
      <td>0.192652</td>
      <td>0.394427</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Moderate_work_activity</th>
      <td>4354.0</td>
      <td>0.338769</td>
      <td>0.473346</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Walk_or_bicycle</th>
      <td>4356.0</td>
      <td>0.254821</td>
      <td>0.435811</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Vigorous_rec_activity</th>
      <td>4356.0</td>
      <td>0.246097</td>
      <td>0.430785</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Moderate_rec_activity</th>
      <td>4356.0</td>
      <td>0.432277</td>
      <td>0.495449</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Tried_weight_loss_past_year</th>
      <td>3857.0</td>
      <td>0.363495</td>
      <td>0.481068</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Healthy_diet</th>
      <td>4356.0</td>
      <td>2.931359</td>
      <td>0.995567</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>WBC_count</th>
      <td>4356.0</td>
      <td>7.238522</td>
      <td>2.313441</td>
      <td>2.500000</td>
      <td>5.700000</td>
      <td>6.900000</td>
      <td>8.400000</td>
      <td>55.700000</td>
    </tr>
    <tr>
      <th>RBC_count</th>
      <td>4356.0</td>
      <td>4.663620</td>
      <td>0.482255</td>
      <td>1.670000</td>
      <td>4.347500</td>
      <td>4.640000</td>
      <td>4.970000</td>
      <td>8.300000</td>
    </tr>
    <tr>
      <th>Hematocrit</th>
      <td>4356.0</td>
      <td>41.543251</td>
      <td>4.032086</td>
      <td>17.900000</td>
      <td>38.900000</td>
      <td>41.500000</td>
      <td>44.300000</td>
      <td>55.900000</td>
    </tr>
    <tr>
      <th>Triglycerides</th>
      <td>4306.0</td>
      <td>143.406410</td>
      <td>105.113638</td>
      <td>20.000000</td>
      <td>76.000000</td>
      <td>113.000000</td>
      <td>176.000000</td>
      <td>1213.000000</td>
    </tr>
    <tr>
      <th>Uric_acid</th>
      <td>4308.0</td>
      <td>5.387303</td>
      <td>1.384542</td>
      <td>0.700000</td>
      <td>4.400000</td>
      <td>5.300000</td>
      <td>6.300000</td>
      <td>13.300000</td>
    </tr>
    <tr>
      <th>Osmolality</th>
      <td>4309.0</td>
      <td>279.061963</td>
      <td>4.825951</td>
      <td>237.000000</td>
      <td>276.000000</td>
      <td>279.000000</td>
      <td>282.000000</td>
      <td>323.000000</td>
    </tr>
    <tr>
      <th>Sodium</th>
      <td>4309.0</td>
      <td>139.882571</td>
      <td>2.205999</td>
      <td>119.000000</td>
      <td>139.000000</td>
      <td>140.000000</td>
      <td>141.000000</td>
      <td>154.000000</td>
    </tr>
    <tr>
      <th>Potassium</th>
      <td>4308.0</td>
      <td>4.002948</td>
      <td>0.347091</td>
      <td>2.800000</td>
      <td>3.800000</td>
      <td>4.000000</td>
      <td>4.200000</td>
      <td>5.800000</td>
    </tr>
    <tr>
      <th>Gamma_glutamyl_transferase</th>
      <td>4308.0</td>
      <td>27.459146</td>
      <td>46.812967</td>
      <td>5.000000</td>
      <td>13.000000</td>
      <td>18.000000</td>
      <td>28.000000</td>
      <td>1510.000000</td>
    </tr>
    <tr>
      <th>Calcium</th>
      <td>4289.0</td>
      <td>9.451131</td>
      <td>0.363228</td>
      <td>7.600000</td>
      <td>9.200000</td>
      <td>9.400000</td>
      <td>9.700000</td>
      <td>14.800000</td>
    </tr>
    <tr>
      <th>Alanine_aminotransferase</th>
      <td>4307.0</td>
      <td>24.831437</td>
      <td>19.528176</td>
      <td>6.000000</td>
      <td>16.000000</td>
      <td>20.000000</td>
      <td>27.000000</td>
      <td>536.000000</td>
    </tr>
    <tr>
      <th>Aspartate_aminotransferase</th>
      <td>4307.0</td>
      <td>25.300906</td>
      <td>19.612550</td>
      <td>9.000000</td>
      <td>19.000000</td>
      <td>22.000000</td>
      <td>27.000000</td>
      <td>882.000000</td>
    </tr>
    <tr>
      <th>Pre_diab</th>
      <td>4356.0</td>
      <td>0.346419</td>
      <td>0.475883</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>SBP_to_DBP</th>
      <td>4222.0</td>
      <td>1.765659</td>
      <td>0.331493</td>
      <td>1.272727</td>
      <td>1.550097</td>
      <td>1.684448</td>
      <td>1.880256</td>
      <td>5.470588</td>
    </tr>
    <tr>
      <th>Waist_to_hgt</th>
      <td>4152.0</td>
      <td>0.581131</td>
      <td>0.095154</td>
      <td>0.364412</td>
      <td>0.514059</td>
      <td>0.571075</td>
      <td>0.635716</td>
      <td>1.063995</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># missingness</span>
<span class="n">miss_count</span> <span class="o">=</span> <span class="n">prediab_eda</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">miss_pct</span> <span class="o">=</span> <span class="n">miss_count</span><span class="p">[</span><span class="n">miss_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">prediab_eda</span><span class="p">)</span>
<span class="n">miss_pct</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_78_1.png" src="../_images/tutorial_test_Classification_with_Facet_78_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># those variables that are complete</span>
<span class="n">miss_count</span><span class="p">[</span><span class="n">miss_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">prediab_eda</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Age                      0.0
Gender                   0.0
Family_hist_diab         0.0
Walk_or_bicycle          0.0
Vigorous_rec_activity    0.0
Moderate_rec_activity    0.0
Healthy_diet             0.0
WBC_count                0.0
RBC_count                0.0
Hematocrit               0.0
Pre_diab                 0.0
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># view correlations with a heatmap</span>
<span class="n">df_cor</span> <span class="o">=</span> <span class="n">prediab_eda</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_cor</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">df_cor</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">df_cor</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_test_Classification_with_Facet_80_1.png" src="../_images/tutorial_test_Classification_with_Facet_80_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># let&#39;s do a table comparing features by the target</span>
<span class="n">categorical</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Gender&quot;</span><span class="p">,</span>
    <span class="s2">&quot;High_BP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Trouble_sleeping&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sleep_disorder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Told_overweight&quot;</span><span class="p">,</span>
    <span class="s2">&quot;General_health&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Family_hist_diab&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Feel_at_risk_diab&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Vigorous_work_activity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Moderate_work_activity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Walk_or_bicycle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Vigorous_rec_activity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Moderate_rec_activity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tried_weight_loss_past_year&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Healthy_diet&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">mytable</span> <span class="o">=</span> <span class="n">TableOne</span><span class="p">(</span>
    <span class="n">prediab_eda</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">prediab_eda</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
    <span class="n">categorical</span><span class="o">=</span><span class="n">categorical</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">,</span>
    <span class="n">pval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">remarks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">overall</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mytable</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/2_/2w71_hc95zl2vs3jr0tq9y4m0000gn/T/ipykernel_3632/3085795373.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> ]
<span class="ansi-green-intense-fg ansi-bold">     19</span>
<span class="ansi-green-fg">---&gt; 20</span><span class="ansi-red-fg"> mytable = TableOne(
</span><span class="ansi-green-intense-fg ansi-bold">     21</span>     prediab_eda<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>     columns<span class="ansi-blue-fg">=</span>prediab_eda<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>drop<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Pre_diab&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>to_list<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>

<span class="ansi-red-fg">NameError</span>: name &#39;TableOne&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># KDE plots by prediabetes status as well for those continuous features</span>
<span class="n">distn_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Waist_Circumference&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Weight&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Standing_Height&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BMI&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Average_SBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Average_DBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HDL_Cholesterol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Total_Cholesterol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sleep_hours&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WBC_count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RBC_count&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hematocrit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Triglycerides&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Uric_acid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Osmolality&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Potassium&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gamma_glutamyl_transferase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Calcium&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Alanine_aminotransferase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Aspartate_aminotransferase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SBP_to_DBP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Waist_to_hgt&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">df_kde</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">prediab_eda</span><span class="p">[</span><span class="n">distn_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">]],</span> <span class="s2">&quot;Pre_diab&quot;</span><span class="p">,</span> <span class="n">distn_vars</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span>
    <span class="n">df_kde</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Pre_diab&quot;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>Quick EDA summary:</strong></p>
<p>Missingness</p>
<ul class="simple">
<li><p>Our target and 10 features were complete.</p></li>
<li><p>The other 29 features had levels of missing ranging from 0.02% to 11.5%, and 22 of the 29 were &lt;3%.</p></li>
<li><p>Most extreme cases of missingness were for tried weight loss in the past year (11.5%) and general health (7.8%).</p></li>
</ul>
<p>Correlations</p>
<ul class="simple">
<li><p>There is a wide range of correlation among features, where we can see that for example RBC count, haematocrit and standing height are all moderately negatively correlated with gender (i.e., females are shorter), and that body measurements for weight, height, BMI, and waist circumference are all strongly positively correlated.</p></li>
</ul>
<p>Associations</p>
<ul class="simple">
<li><p>Some features already appear to not to be strongly associated based on univariate tests, such as: average DBP, trouble sleeping, vigorous work activity, moderate work activity, tried weight loss in the past year, healthy diet, WBC count, and calcium levels.</p></li>
<li><p>Features associated with an increased risk of prediabetes include: older age, being male, increased waist circumference, decreased standing height, increased weight, increased BMI, increased average SBP, lower HDL cholesterol, increased total cholesterol, having high BP, increased sleep hours, having a sleep disorder, being told you are overweight, poorer general health, family history of diabetes, feeling at risk for diabetes, reduced walking or cycling, less vigorous or moderate
recreational activity, higher RBC count, higher haematocrit, increased triglycerides, increased uric acid, higher osmolality, increased sodium, increased potassium, increased gamma glutamyl transferase, increased alanine aminotransferase, increased aspartate aminotransferase, increased SBP to DBP ratio, increased waist to height ratio.</p></li>
</ul>
<p>Distributions of numeric features</p>
<ul class="simple">
<li><p>Many of the continuous features have been flagged as potentially non-normal/multi-modal and with potential outliers. This can be seen in the plots where many biomarkers have positive skewed distributions and in the case of sodium, some modality which could also be related to measurement.</p></li>
</ul>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2021, Boston Consulting Group (BCG).<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>